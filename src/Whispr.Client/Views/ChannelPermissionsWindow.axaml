<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        x:Class="Whispr.Client.Views.ChannelPermissionsWindow"
        Title="{Binding Title}"
        Width="420" Height="480"
        MinWidth="360" MinHeight="320"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource WhisprSurface}">
    <Grid RowDefinitions="Auto,Auto,*,Auto" Margin="24">
        <TextBlock x:Name="TitleText" Grid.Row="0" Text="{Binding Title}" FontSize="18" FontWeight="SemiBold" Foreground="#ffffff" Margin="0,0,0,16"/>
        <StackPanel Grid.Row="1" Margin="0,0,0,8">
            <TextBlock x:Name="LoadingText" Text="Loading..." Foreground="{DynamicResource WhisprTextMuted}" FontSize="12" IsVisible="{Binding IsLoading}"/>
            <TextBlock x:Name="ErrorText" Text="{Binding ErrorMessage}" Foreground="{DynamicResource WhisprDanger}" FontSize="12" TextWrapping="Wrap" IsVisible="{Binding HasError}"/>
            <TextBlock x:Name="HintText" Text="Control who can access this channel. Empty = public. Deny overrides Allow." Foreground="{DynamicResource WhisprTextMuted}" FontSize="11" TextWrapping="Wrap" IsVisible="{Binding IsHintVisible}"/>
        </StackPanel>
        <ScrollViewer x:Name="ContentScroll" Grid.Row="2" VerticalScrollBarVisibility="Auto" IsVisible="{Binding IsContentVisible}">
            <StackPanel Spacing="16">
                <TextBlock Text="Roles (channel access)" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource WhisprTextSecondary}"/>
                <ItemsControl x:Name="RolesList" ItemsSource="{Binding RolesList}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{DynamicResource WhisprSurfaceLight}" CornerRadius="6" Padding="12" Margin="0,0,0,8">
                                <Grid ColumnDefinitions="*,Auto">
                                    <TextBlock Grid.Column="0" Text="{Binding Name}" FontWeight="SemiBold" Foreground="#ffffff" VerticalAlignment="Center"/>
                                    <ComboBox Grid.Column="1" Width="100" VerticalAlignment="Center"
                                              SelectedItem="{Binding SelectedState}"
                                              ItemsSource="{Binding StateOptions}"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                <TextBlock Text="Users (channel access)" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource WhisprTextSecondary}" Margin="0,8,0,0"/>
                <ItemsControl x:Name="UsersList" ItemsSource="{Binding UsersList}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{DynamicResource WhisprSurfaceLight}" CornerRadius="6" Padding="12" Margin="0,0,0,8">
                                <Grid ColumnDefinitions="*,Auto">
                                    <TextBlock Grid.Column="0" Text="{Binding Username}" FontWeight="SemiBold" Foreground="#ffffff" VerticalAlignment="Center"/>
                                    <ComboBox Grid.Column="1" Width="100" VerticalAlignment="Center"
                                              SelectedItem="{Binding SelectedState}"
                                              ItemsSource="{Binding StateOptions}"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </ScrollViewer>
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="12" Margin="0,16,0,0">
            <Button x:Name="ApplyButton" Content="Apply" Width="80" Command="{Binding ApplyCommand}"
                    IsEnabled="{Binding IsApplyEnabled}"
                    Background="{DynamicResource WhisprAccent}" Foreground="#ffffff"/>
            <Button x:Name="CloseButton" Content="Close" Width="80" Click="OnCloseClick"/>
        </StackPanel>
    </Grid>
</Window>
