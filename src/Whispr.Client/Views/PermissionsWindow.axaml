<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        x:Class="Whispr.Client.Views.PermissionsWindow"
        Title="{Binding Title}"
        Width="420" Height="480"
        MinWidth="360" MinHeight="320"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource WhisprSurface}">
    <Grid RowDefinitions="Auto,Auto,*,Auto" Margin="24">
        <TextBlock x:Name="TitleText" Grid.Row="0" Text="{Binding Title}" FontSize="18" FontWeight="SemiBold" Foreground="#ffffff" Margin="0,0,0,16"/>
        <TextBlock x:Name="LoadingText" Grid.Row="1" Text="Loading..." Foreground="{DynamicResource WhisprTextMuted}" FontSize="12" Margin="0,0,0,8" IsVisible="{Binding IsLoading}"/>
        <TextBlock x:Name="ErrorText" Grid.Row="1" Text="{Binding ErrorMessage}" Foreground="{DynamicResource WhisprDanger}" FontSize="12" Margin="0,0,0,8" TextWrapping="Wrap" IsVisible="{Binding HasError}"/>
        <ScrollViewer x:Name="ContentScroll" Grid.Row="2" VerticalScrollBarVisibility="Auto" IsVisible="{Binding IsContentVisible}">
            <StackPanel Spacing="16">
                <TextBlock Text="Direct permissions" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource WhisprTextSecondary}"/>
                <ItemsControl x:Name="PermissionsList" ItemsSource="{Binding PermissionsList}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{DynamicResource WhisprSurfaceLight}" CornerRadius="6" Padding="12" Margin="0,0,0,8">
                                <Grid ColumnDefinitions="*,Auto,Auto">
                                    <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Name}" FontWeight="SemiBold" Foreground="#ffffff"/>
                                        <TextBlock Text="{Binding Description}" Foreground="{DynamicResource WhisprTextMuted}" FontSize="11" IsVisible="{Binding HasDescription}"/>
                                        <TextBlock Text="{Binding EffectiveHint}" Foreground="{DynamicResource WhisprTextMuted}" FontSize="10" FontStyle="Italic" IsVisible="{Binding HasEffectiveHint}"/>
                                    </StackPanel>
                                    <ComboBox Grid.Column="1" Width="100" VerticalAlignment="Center" Margin="0,0,8,0"
                                              SelectedItem="{Binding SelectedState}"
                                              ItemsSource="{Binding StateOptions}"/>
                                    <TextBlock Grid.Column="2" Text="{Binding EffectiveLabel}" Foreground="{DynamicResource WhisprTextSecondary}" FontSize="10" VerticalAlignment="Center"
                                               ToolTip.Tip="{Binding EffectiveTooltip}" IsVisible="{Binding HasEffectiveHint}"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                <TextBlock Text="Roles" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource WhisprTextSecondary}" Margin="0,8,0,0"/>
                <ItemsControl x:Name="RolesList" ItemsSource="{Binding RolesList}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{DynamicResource WhisprSurfaceLight}" CornerRadius="6" Padding="12" Margin="0,0,0,8"
                                    ToolTip.Tip="{Binding PermissionSummary}">
                                <CheckBox IsChecked="{Binding IsAssigned}" Content="{Binding DisplayContent}" Foreground="#ffffff"/>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </ScrollViewer>
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="12" Margin="0,16,0,0">
            <Button x:Name="ApplyButton" Content="Apply" Width="80" Command="{Binding ApplyCommand}"
                    IsEnabled="{Binding IsApplyEnabled}"
                    Background="{DynamicResource WhisprAccent}" Foreground="#ffffff"/>
            <Button x:Name="CloseButton" Content="Close" Width="80" Click="OnCloseClick"/>
        </StackPanel>
    </Grid>
</Window>
